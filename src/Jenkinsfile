pipeline {
    agent any  // Usar cualquier agente disponible (nodo de ejecución)

    environment {
        VERCEL_TOKEN = credentials('v0FUVu3EStBDDT1r1kt6Pn5z1')  // Asegúrate de haber creado esta credencial en Jenkins
    }

    stages {
        stage('Clonar') {1
            steps {
                git credentialsId: 'B188154A-B5DB-4823-81D6-C2FE7F033E16', url: 'https://github.com/AlejaRosero/chimayoy.git', branch: 'main'
            }
        }

        stage('Instalar dependencias') {
            steps {
                bat 'npm install'
            }
        }

        stage('Construir') {
            steps {
                bat 'npm run build'
            }
        }

        stage('Ver archivos generados') {
            steps {
                bat 'dir dist'
            }
        }

        stage('Desplegar en Vercel') {
            steps {
                bat "vercel --token=%VERCEL_TOKEN% --prod --yes"
            }
        }
    }

    post {
        success {
            echo 'El pipeline se ejecutó correctamente en Windows.'
        }
        failure {
            echo 'Hubo un error en alguna etapa del pipeline.'
        }
    }
}
